function thwdpfCloseModal(elm){thwdpf_base.form_wizard_close(elm)}function thwdpfWizardNext(elm){thwdpf_base.form_wizard_next(elm)}function thwdpfWizardPrevious(elm){thwdpf_base.form_wizard_previous(elm)}function thwdpfAddNewConditionRow(elm,op){thwdpf_conditions.add_new_rule_row(elm,op)}function thwdpfRemoveRuleRow(elm){thwdpf_conditions.remove_rule_row(elm)}function thwdpfOpenNewRuleForm(elm,context){thwdpf_settings_rule.open_new_rule_form(context)}function thwdpfOpenEditRuleForm(elm){thwdpf_settings_rule.open_edit_rule_form(elm)}function thwdpfOpenCopyRuleForm(elm){thwdpf_settings_rule.open_copy_rule_form(elm)}function thwdpfEnableDisableRule(elm,rname){thwdpf_settings_rule.enable_disable_rule(elm,rname)}function thwdpfDeleteRule(elm,rname){thwdpf_settings_rule.delete_rule(elm,rname)}function thwdpfDeleteSelectedRules(elm,context){thwdpf_settings_rule.delete_selected_rules(elm)}function thwdpfSelectAllRules(elm){thwdpf_settings_rule.select_all_rules(elm)}function thwdpfSaveRule(elm){thwdpf_settings_rule.save_rule(elm)}function thwdpfAddNewRangeRow(elm){thwdpf_settings_rule.add_new_range_row(elm)}function thwdpfRemoveRangeRow(elm){thwdpf_settings_rule.remove_range_row(elm)}function thwdpfMethodChangeListener(elm){thwdpf_settings_rule.method_change_listener(elm)}function thwdpfNeedLoginChangeListener(elm){thwdpf_settings_rule.need_login_change_listener(elm)}function thwdpfCloseReviewRequestNotice(elm){thwdpf_settings.close_review_request_notice(elm)}var thwdpf_base=function($,window,document){"use strict";function escapeHTML(html){var fn=function(tag){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;"}[tag]||tag};return html.replace(/[&<>"]/g,fn)}function decodeHtml(str){if(str&&"string"==typeof str){var map={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#039;":"'"};return str.replace(/&amp;|&lt;|&gt;|&quot;|&#039;/g,function(m){return map[m]})}return str}function isHtmlIdValid(id){return/^[a-z\_]+[a-z0-9\_]*$/.test(id.trim())}function isValidHexColor(value){return!!preg_match("/^#[a-f0-9]{6}$/i",value)}function is_option_field(type){var result=!1;return"select"!=type&&"multiselect"!=type&&"radio"!=type&&"checkboxgroup"!=type||(result=!0),result}function prepare_datetime_obj(date_str,time_str){var datetime="";return date_str&&(date_str+=time_str?" "+time_str:"",datetime=new Date(date_str)),datetime}function setup_tiptip_tooltips(){var tiptip_args={attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200};$(".tips").tipTip(tiptip_args)}function setup_datepicker(parent){parent.find(".thwdpf-datepicker").each(function(){$(this).datepicker({dateFormat:"M dd yy"})})}function setup_timepicker(parent){parent.find(".thwdpf-timepicker").each(function(){var args={step:"30",timeFormat:"H:i",show2400:!0,forceRoundTime:!0,disableTextInput:!1,disableTouchKeyboard:!0};$(this).timepicker(args)})}function setup_enhanced_multi_select(parent){parent.find("select.thwdpf-enhanced-multi-select").each(function(){$(this).hasClass("enhanced")||$(this).selectWoo({allowClear:!0,placeholder:$(this).data("placeholder")}).addClass("enhanced")})}function setup_enhanced_multi_select_with_value(parent){parent.find("select.thwdpf-enhanced-multi-select").each(function(){if(!$(this).hasClass("enhanced")){$(this).selectWoo({allowClear:!0,placeholder:$(this).data("placeholder")}).addClass("enhanced");var value=$(this).data("value");value=value.split(","),$(this).val(value),$(this).trigger("change")}})}function setup_product_dropdown(parent,set_dv){parent.find("select.thwdpf-product-select").each(function(){if(set_dv&&!$(this).hasClass("populated")&&prepare_selected_options($(this)),!$(this).hasClass("enhanced")){$(this).selectWoo({allowClear:!0,placeholder:$(this).attr("placeholder"),escapeMarkup:function(text){return text},ajax:{type:"POST",url:wdpf_var.ajax_url,dataType:"json",data:function(params){return{action:"thwdpf_load_products",term:params.term||"",page:params.page||1}},processResults:function(result,params){return result.data},cache:!0}}).addClass("enhanced")}})}function prepare_selected_options(elm){var value=elm.data("value");if(value&&value.length>0){var data={action:"thwdpf_load_products",value:value};$.ajax({type:"POST",url:wdpf_var.ajax_url,data:data,success:function(result){elm.find("option").remove(),$.each(result.data.results,function(key,value){var newOption=new Option(value.text,value.id,!0,!0);elm.append(newOption)}),elm.addClass("populated"),elm.trigger("change")}})}}function setup_color_picker(form){form.find(".thpladmin-colorpick").iris({change:function(event,ui){$(this).parent().find(".thpladmin-colorpickpreview").css({backgroundColor:ui.color.toString()})},hide:!0,border:!0}).click(function(){$(".iris-picker").hide(),$(this).closest("td").find(".iris-picker").show()}),$("body").click(function(){$(".iris-picker").hide()}),$(".thpladmin-colorpick").click(function(event){event.stopPropagation()})}function setup_color_pick_preview(form){form.find(".thpladmin-colorpick").each(function(){$(this).parent().find(".thpladmin-colorpickpreview").css({backgroundColor:this.value})})}function prepare_rule_order_indexes(elm){$(elm+" tbody tr").each(function(index,el){$("input.i_priority",el).val(parseInt($(el).index(elm+" tbody tr")))}),save_changes(elm)}function save_changes(elm){var form=$(elm).closest("form");form.find("input[name=i_action]").val("auto_save"),form.submit()}function setup_sortable_table(parent,elm,left){parent.find(elm+" tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:".sort",scrollSensitivity:40,helper:function(e,ui){return ui.children().each(function(){$(this).width($(this).width())}),ui.css("left",left),ui}}),$(elm+" tbody").on("sortstart",function(event,ui){ui.item.css("background-color","#f6f6f6")}),$(elm+" tbody").on("sortstop",function(event,ui){ui.item.removeAttr("style"),prepare_rule_order_indexes(elm)})}function get_property_field_value(form,type,name){var value="";switch(type){case"select":value=form.find("select[name=i_"+name+"]").val(),value=null==value?"":value;break;case"checkbox":value=form.find("input[name=i_"+name+"]").prop("checked"),value=value?1:0;break;case"textarea":value=form.find("textarea[name=i_"+name+"]").val(),value=null==value?"":value;break;default:value=form.find("input[name=i_"+name+"]").val(),value=null==value?"":value}return value}function set_property_field_value(form,type,name,value,multiple){switch(type){case"select":1==multiple?(value="string"==typeof value?value.split(","):value,name+="[]",form.find('select[name="i_'+name+'"]').val(value).trigger("change")):form.find('select[name="i_'+name+'"]').val(value);break;case"checkbox":value=1==value||"yes"==value,form.find("input[name=i_"+name+"]").prop("checked",value);break;case"textarea":value=value?decodeHtml(value):value,form.find("textarea[name=i_"+name+"]").val(value);break;case"colorpicker":var bg_color=value?{backgroundColor:value}:{};form.find("input[name=i_"+name+"]").val(value),form.find("."+name+"_preview").css(bg_color);break;default:value=value?decodeHtml(value):value,form.find("input[name=i_"+name+"]").val(value)}}function set_data_attribute(form,type,name,multiple,attr_name,attr_value){var elm=get_element(form,type,name,multiple);elm&&elm.data(attr_name,attr_value)}function get_data_attribute(form,type,name,multiple,attr_name){var attr_value=null,elm=get_element(form,type,name,multiple);return elm&&(attr_value=elm.data(attr_name)),attr_value}function get_element(form,type,name,multiple){var elm=null;switch(type){case"select":name=1==multiple?name+"[]":name,elm=form.find('select[name="i_'+name+'"]');break;case"textarea":elm=form.find("textarea[name=i_"+name+"]");break;default:elm=form.find("input[name=i_"+name+"]")}return elm}function setup_form_wizard(){$(".pp_nav_links > li").click(function(){var index=$(this).data("index");open_tab($(this).closest(".thpladmin-modal-mask"),$(this),index),active_tab=index})}function get_popup(elm){return $(elm).closest(".thpladmin-modal-mask")}function get_active_tab(popup){return popup.find("ul.pp_nav_links").find("li.active")}function get_next_tab_index(elm){var popup=get_popup(elm),active=get_active_tab(popup),link=active.nextAll("li").not(".disabled").first();return link.length?link.data("index"):active_tab}function get_prev_tab_index(elm){var popup=get_popup(elm),active=get_active_tab(popup),link=active.prevAll("li").not(".disabled").first();return link.length?link.data("index"):active_tab}function form_wizard_open(popup){active_tab=0,popup.find("ul.pp_nav_links li").first().click(),popup.css("display","block")}function form_wizard_close(elm){get_popup(elm).css("display","none"),active_tab=0}function form_wizard_next(elm){active_tab=get_next_tab_index(elm),move_to(elm,active_tab)}function form_wizard_previous(elm){active_tab=get_prev_tab_index(elm),move_to(elm,active_tab)}function form_wizard_start(elm){active_tab=0,move_to(elm,active_tab)}function move_to(elm,index){var popup=get_popup(elm);open_tab(popup,popup.find('*[data-index="'+index+'"]'),index)}function open_tab(popup,link,index){var panel=popup.find(".data_panel_"+index);close_all_data_panel(popup),link.addClass("active"),panel.css("display","block"),enable_disable_btns(popup,link)}function close_all_data_panel(popup){popup.find(".pp_nav_links > li").removeClass("active"),popup.find(".data-panel").css("display","none")}function enable_disable_tab(popup,index,disable){var link=popup.find('*[data-index="'+index+'"]'),panel=popup.find(".data_panel_"+index);disable?(link.addClass("disabled"),panel.find(":input").attr("disabled",!0)):(link.removeClass("disabled"),panel.find(":input").attr("disabled",!1))}function form_wizard_enable_tab(popup,index){enable_disable_tab(popup,index,0)}function form_wizard_disable_tab(popup,index){enable_disable_tab(popup,index,1)}function form_wizard_enable_all_tabs(popup){popup.find(".pp_nav_links > li").removeClass("disabled")}function enable_disable_btns(popup,link){var nextBtn=popup.find(".next-btn"),prevBtn=popup.find(".prev-btn");link.hasClass("first")?(nextBtn.prop("disabled",!1),prevBtn.prop("disabled",!0)):link.hasClass("last")?(nextBtn.prop("disabled",!0),prevBtn.prop("disabled",!1)):(nextBtn.prop("disabled",!1),prevBtn.prop("disabled",!1))}var active_tab=0;return{escapeHTML:escapeHTML,decodeHtml:decodeHtml,isHtmlIdValid:isHtmlIdValid,isValidHexColor:isValidHexColor,is_option_field:is_option_field,prepare_datetime_obj:prepare_datetime_obj,setup_tiptip_tooltips:setup_tiptip_tooltips,setup_datepicker:setup_datepicker,setup_timepicker:setup_timepicker,setup_enhanced_multi_select:setup_enhanced_multi_select,setup_enhanced_multi_select_with_value:setup_enhanced_multi_select_with_value,setup_product_dropdown:setup_product_dropdown,prepare_selected_options:prepare_selected_options,setupColorPicker:setup_color_picker,setup_color_pick_preview:setup_color_pick_preview,setup_sortable_table:setup_sortable_table,get_property_field_value:get_property_field_value,set_property_field_value:set_property_field_value,set_data_attribute:set_data_attribute,get_data_attribute:get_data_attribute,setup_form_wizard:setup_form_wizard,form_wizard_open:form_wizard_open,form_wizard_close:form_wizard_close,form_wizard_next:form_wizard_next,form_wizard_previous:form_wizard_previous,form_wizard_start:form_wizard_start,form_wizard_enable_tab:form_wizard_enable_tab,form_wizard_disable_tab:form_wizard_disable_tab,form_wizard_enable_all_tabs:form_wizard_enable_all_tabs,get_element:get_element}}(window.jQuery,window,document),thwdpf_conditions=function($,window,document){"use strict";function set_context(form){context=thwdpf_base.get_property_field_value(form,"text","context"),init_contants()}function get_operand_types(){return"cart"===context?RULE_OPERAND_TYPE_SET_CART:RULE_OPERAND_TYPE_SET_PRODUCT}function init_contants(){CONDITION_HTML=populate_condition_html(null,!0,!0,!1),CONDITION_SET_HTML=populate_condition_set_html(CONDITION_HTML,!0),CONDITION_SET_HTML_WITH_OR=populate_condition_set_html(CONDITION_HTML,!1),RULE_HTML=populate_rule_html(CONDITION_SET_HTML),RULE_SET_HTML=populate_rule_set_html(RULE_HTML)}function prepareRuleOperandTypeSet(value){var operand_types=get_operand_types(),html='<select name="i_rule_operand_type" value="'+value+'">';return html+='<option value="">'+__("Select an option...","discount-and-dynamic-pricing")+"</option>",$.each(operand_types,function(glabel,options){$.each(options,function(ovalue,olabel){html+='<option value="'+ovalue+'" '+(ovalue===value?"selected":"")+">"+olabel+"</option>"})}),html+="</select>"}function prepareRuleOperatorSet(value){var html='<select name="i_rule_operator" value="'+value+'">';return html+='<option value="">'+__("Select an option...","discount-and-dynamic-pricing")+"</option>",$.each(RULE_OPERATOR_SET,function(ovalue,olabel){html+='<option value="'+ovalue+'" '+(ovalue===value?"selected":"")+">"+olabel+"</option>"}),html+="</select>"}function prepareRuleOperandSet(value){return'<input type="text" name="i_rule_operand" value="'+value+'">'}function is_condition_with_no_operand_type(operator){return!!(operator&&$.inArray(operator,RULE_OPERATOR_SET_NO_TYPE)>-1)}function is_valid_condition(condition){return!(!condition.operand_type||!condition.operator)||!(!is_condition_with_no_operand_type(condition.operator)||!condition.operand)}function add_new_rule_row(elm,op){var condition_row=$(elm).closest("tr"),condition={};if(condition.operand_type=condition_row.find("select[name=i_rule_operand_type]").val(),condition.operator=condition_row.find("select[name=i_rule_operator]").val(),condition.operand=condition_row.find("input[name=i_rule_operand]").val(),!is_valid_condition(condition))return void alert(__("Please provide a valid condition.","discount-and-dynamic-pricing"));if(!$.isNumeric(condition.operand))return void alert(__("Please provide a numeric value for the value field.","discount-and-dynamic-pricing"));if(1==op){var conditionSetTable=$(elm).closest(".thwdpf_condition_set");conditionSetTable.find("tbody tr.thwdpf_condition").size()>0?($(elm).closest("td").html(OP_AND_HTML),conditionSetTable.find("tbody tr.thwdpf_condition:last").after(CONDITION_HTML)):conditionSetTable.find("tbody").append(CONDITION_HTML)}else if(2==op){var ruleTable=$(elm).closest(".thwdpf_rule"),ruleSize=ruleTable.find("tbody tr.thwdpf_condition_set_row").size();ruleSize>0?ruleTable.find("tbody tr.thwdpf_condition_set_row:last").after(CONDITION_SET_HTML_WITH_OR):ruleTable.find("tbody").append(CONDITION_SET_HTML)}}function remove_rule_row(elm){var ctable=$(elm).closest("table.thwdpf_condition_set"),rtable=$(elm).closest("table.thwdpf_rule");$(elm).closest("tr.thwdpf_condition").remove();var cSize=ctable.find("tbody tr.thwdpf_condition").size();0==cSize?ctable.closest("tr.thwdpf_condition_set_row").remove():ctable.find("tbody tr.thwdpf_condition:last").find("td.actions").html(OP_HTML);var rSize=rtable.find("tbody tr.thwdpf_condition_set_row").size();0==cSize&&0==rSize&&rtable.find("tbody").append(CONDITION_SET_HTML)}function get_conditional_rules(parent){return get_conditional_rules_json($(parent).find(".thwdpf_conditional_rules > tbody"))}function get_conditional_rules_json(parent){var conditionalRules=[],ruleSet=[],rule=[],conditions=[],condition={};parent.find("tr.thwdpf_rule_set_row").each(function(){ruleSet=[],$(this).find("table.thwdpf_rule_set > tbody tr.thwdpf_rule_row").each(function(){rule=[],$(this).find("table.thwdpf_rule > tbody tr.thwdpf_condition_set_row").each(function(){conditions=[],$(this).find("table.thwdpf_condition_set > tbody tr.thwdpf_condition").each(function(){condition={},condition.operand_type=$(this).find("select[name=i_rule_operand_type]").val(),condition.operator=$(this).find("select[name=i_rule_operator]").val(),condition.operand=$(this).find("input[name=i_rule_operand]").val(),is_valid_condition(condition)&&conditions.push(condition)}),conditions.length>0&&rule.push(conditions)}),rule.length>0&&ruleSet.push(rule)}),ruleSet.length>0&&conditionalRules.push(ruleSet)});var conditionalRulesJson=conditionalRules.length>0?JSON.stringify(conditionalRules):"";return conditionalRulesJson=encodeURIComponent(conditionalRulesJson)}function populate_conditional_rules(form,conditionalRulesJson,ajaxFlag){var conditionalRulesHtml="";if(conditionalRulesJson)try{conditionalRulesJson=decodeURIComponent(conditionalRulesJson);var conditionalRules=$.parseJSON(conditionalRulesJson);conditionalRules&&jQuery.each(conditionalRules,function(){var ruleSet=this,rulesHtml="";jQuery.each(ruleSet,function(){var rule=this,conditionSetsHtml="",y=0;rule.length;jQuery.each(rule,function(){var conditions=this,conditionsHtml="",x=1,size=conditions.length;jQuery.each(conditions,function(){var lastRow=x==size,conditionHtml=populate_condition_html(this,!1,lastRow,ajaxFlag);conditionHtml&&(conditionsHtml+=conditionHtml),x++});var firstRule=0==y,conditionSetHtml=populate_condition_set_html(conditionsHtml,firstRule);conditionSetHtml&&(conditionSetsHtml+=conditionSetHtml),y++});var ruleHtml=populate_rule_html(conditionSetsHtml);ruleHtml&&(rulesHtml+=ruleHtml)});var ruleSetHtml=populate_rule_set_html(rulesHtml);ruleSetHtml&&(conditionalRulesHtml+=ruleSetHtml)})}catch(err){alert(err)}var conditionalRulesTable=form.find(".thwdpf_conditional_rules > tbody");conditionalRulesHtml?(conditionalRulesTable.html(conditionalRulesHtml),thwdpf_base.setup_enhanced_multi_select(conditionalRulesTable)):(conditionalRulesTable.html(RULE_SET_HTML),thwdpf_base.setup_enhanced_multi_select(conditionalRulesTable),thwdpf_base.setup_product_dropdown(conditionalRulesTable,!1))}function populate_rule_set_html(ruleHtml){var html="";return ruleHtml&&(html+='<tr class="thwdpf_rule_set_row"><td><table class="thwdpf_rule_set"><tbody>',html+=ruleHtml,html+="</tbody></table></td></tr>"),html}function populate_rule_html(conditionSetHtml){var html="";return conditionSetHtml&&(html+='<tr class="thwdpf_rule_row"><td><table class="thwdpf_rule"><tbody>',html+=conditionSetHtml,html+="</tbody></table></td></tr>"),html}function populate_condition_set_html(conditionsHtml,firstRule){var html="";return conditionsHtml&&(firstRule?(html+='<tr class="thwdpf_condition_set_row"><td><table class="thwdpf_condition_set"><tbody>',html+=conditionsHtml,html+="</tbody></table></td></tr>"):(html+='<tr class="thwdpf_condition_set_row"><td><table class="thwdpf_condition_set"><thead>'+OP_OR_HTML+"</thead><tbody>",html+=conditionsHtml,html+="</tbody></table></td></tr>")),html}function populate_condition_html(condition,renderEmpty,lastRow,ajaxFlag){var html="";if(condition||renderEmpty){var opType="",operand="",operator="";condition&&(opType=condition.operand_type?condition.operand_type:"",operand=condition.operand?condition.operand:"",operator=condition.operator?condition.operator:"");var actionsHtml=lastRow?OP_HTML:OP_AND_HTML;html+='<tr class="thwdpf_condition">',html+='<td class="operand-type">'+prepareRuleOperandTypeSet(opType)+"</td>",html+='<td class="operator">'+prepareRuleOperatorSet(operator)+"</td>",html+='<td class="operand thpladmin_rule_operand">'+prepareRuleOperandSet(operand)+"</td>",html+='<td class="actions">'+actionsHtml+"</td></tr>"}return html}var _wp$i18n=wp.i18n,__=_wp$i18n.__,context=(_wp$i18n._x,_wp$i18n._n,_wp$i18n._nx,""),RULE_OPERATOR_SET={value_gt:__("Greater than","discount-and-dynamic-pricing"),value_lt:__("Less than","discount-and-dynamic-pricing")},RULE_OPERATOR_SET_NO_TYPE=[],RULE_OPERAND_TYPE_SET_PRODUCT={"Product Properties":{prod_price:__("Product Price","discount-and-dynamic-pricing")},"Cart Properties":{cart_qty:__("Cart Quantity","discount-and-dynamic-pricing")}},RULE_OPERAND_TYPE_SET_CART={"Cart Properties":{cart_qty:__("Cart Quantity","discount-and-dynamic-pricing"),cart_subtotal:__("Cart Subtotal","discount-and-dynamic-pricing")}},OP_AND_HTML='<label class="thpl_logic_label">AND</label>';OP_AND_HTML+='<a href="javascript:void(0)" class="thpl_delete_icon dashicons dashicons-no" onclick="thwdpfRemoveRuleRow(this)" title="Remove"></a>';var OP_OR_HTML='<tr class="thpl_logic_label_or"><td colspan="4" align="center">OR</td></tr>',OP_HTML='<a href="javascript:void(0)" class="thpl_logic_link" onclick="thwdpfAddNewConditionRow(this, 1)" title="">AND</a>';OP_HTML+='<a href="javascript:void(0)" class="thpl_logic_link" onclick="thwdpfAddNewConditionRow(this, 2)" title="">OR</a>',OP_HTML+='<a href="javascript:void(0)" class="thpl_delete_icon dashicons dashicons-no" onclick="thwdpfRemoveRuleRow(this)" title="'+__("Remove","discount-and-dynamic-pricing")+'"></a>';var CONDITION_HTML="",CONDITION_SET_HTML="",CONDITION_SET_HTML_WITH_OR="",RULE_HTML="",RULE_SET_HTML="";return $(function(){}),{set_context:set_context,populate_conditional_rules:populate_conditional_rules,get_conditional_rules:get_conditional_rules,add_new_rule_row:add_new_rule_row,remove_rule_row:remove_rule_row}}(window.jQuery,window,document),thwdpf_settings_rule=function($,window,document){"use strict";function open_new_rule_form(context){open_rule_form("new",!1,context)}function open_edit_rule_form(elm){open_rule_form("edit",elm,!1)}function open_copy_rule_form(elm){open_rule_form("copy",elm,!1)}function open_rule_form(type,elm,context){var popup=$("#thwdpf_rule_form_pp"),form=$("#thwdpf_rule_form");thwdpf_conditions.set_context(form),populate_rule_form(popup,form,type,elm,context),thwdpf_base.form_wizard_open(popup),thwdpf_base.setup_datepicker(form),thwdpf_base.setup_timepicker(form),thwdpf_base.setup_enhanced_multi_select(form),thwdpf_base.setup_product_dropdown(form,"edit"===type)}function populate_rule_form(popup,form,action,elm,context){var title="edit"===action?__("Edit Rule","discount-and-dynamic-pricing"):__("New Rule","discount-and-dynamic-pricing");popup.find(".wizard-title").text(title),form.find(".err_msgs").html(""),form.find("input[name=i_action]").val(action);var row=null,props=null;if("edit"===action||"copy"===action){row=$(elm).closest("tr");var props_json=row.find(".r_props").val();props_json&&(props=JSON.parse(props_json))}populate_rule_form_general(action,form,row,props),form.find("select[name=i_method]").change(),form.find("input[name=i_need_login]").change()}function populate_rule_form_general(action,form,row,props){var name="",priority="",enabled="yes",apply_when="apply_this_only",label="",method="simple",discount_type="fixed",discount_amount="",range_discounts="",start_date="",start_time="",end_date="",end_time="",need_login="",allowed_roles="",allowed_products="",restricted_products="",allowed_cats="",restricted_cats="",restrictions_other="";if(props){name=props.name?props.name:name,priority=props.priority?props.priority:priority,enabled=props.enabled?props.enabled:"",apply_when=props.apply_when?props.apply_when:apply_when,label=props.label?props.label:label,method=props.method?props.method:method,discount_type=props.discount_type?props.discount_type:discount_type,discount_amount=props.discount_amount?props.discount_amount:discount_amount,range_discounts=props.range_discounts?props.range_discounts:"";var schedule=get_schedule(props);start_date=schedule.start_date?schedule.start_date:start_date,start_time=schedule.start_time?schedule.start_time:start_time,end_date=schedule.end_date?schedule.end_date:end_date,end_time=schedule.end_time?schedule.end_time:end_time,need_login=props.need_login?props.need_login:need_login,allowed_roles=props.allowed_roles?props.allowed_roles:allowed_roles,allowed_products=props.allowed_products?props.allowed_products:allowed_products,restricted_products=props.restricted_products?props.restricted_products:restricted_products,allowed_cats=props.allowed_cats?props.allowed_cats:allowed_cats,restricted_cats=props.restricted_cats?props.restricted_cats:restricted_cats,restrictions_other=row.find(".r_restrictions").val()}name="edit"===action?name:"",label="edit"===action?label:"",thwdpf_base.set_property_field_value(form,"hidden","name",name,0),thwdpf_base.set_property_field_value(form,"hidden","priority",priority,0),thwdpf_base.set_property_field_value(form,"checkbox","enabled",enabled,0),thwdpf_base.set_property_field_value(form,"select","apply_when",apply_when,0),thwdpf_base.set_property_field_value(form,"text","label",label,0),thwdpf_base.set_property_field_value(form,"select","method",method,0),thwdpf_base.set_property_field_value(form,"select","discount_type",discount_type,0),thwdpf_base.set_property_field_value(form,"text","discount_amount",discount_amount,0),thwdpf_base.set_property_field_value(form,"text","start_date",start_date,0),thwdpf_base.set_property_field_value(form,"text","start_time",start_time,0),thwdpf_base.set_property_field_value(form,"text","end_date",end_date,0),thwdpf_base.set_property_field_value(form,"text","end_time",end_time,0),thwdpf_base.set_property_field_value(form,"checkbox","need_login",need_login,0),thwdpf_base.set_property_field_value(form,"select","allowed_roles",allowed_roles,1),thwdpf_base.set_property_field_value(form,"select","allowed_products",allowed_products,1),thwdpf_base.set_property_field_value(form,"select","restricted_products",restricted_products,1);var allowed_products_elm=thwdpf_base.get_element(form,"select","allowed_products",1),restricted_products_elm=thwdpf_base.get_element(form,"select","restricted_products",1);allowed_products_elm.removeClass("populated"),restricted_products_elm.removeClass("populated"),thwdpf_base.set_property_field_value(form,"select","allowed_cats",allowed_cats,1),thwdpf_base.set_property_field_value(form,"select","restricted_cats",restricted_cats,1),thwdpf_base.set_data_attribute(form,"select","allowed_products",1,"value",allowed_products),thwdpf_base.set_data_attribute(form,"select","restricted_products",1,"value",restricted_products),populate_range_discounts(form,range_discounts),thwdpf_conditions.populate_conditional_rules(form,restrictions_other,!1)}function get_schedule(props){var schedule_set=props.schedule?props.schedule:"";return $.isArray(schedule_set)&&schedule_set.length>0?schedule_set[0]:array()}function save_rule(elm){var popup=$("#thwdpf_rule_form_pp"),form=$("#thwdpf_rule_form");validate_rule_form(form,popup)&&(prepare_rule_form(form),form.submit())}function validate_rule_form(form,popup){var err_msgs="",rlabel=thwdpf_base.get_property_field_value(form,"text","label"),rmethod=thwdpf_base.get_property_field_value(form,"select","method"),rdisc_type=thwdpf_base.get_property_field_value(form,"select","discount_type");if(rmethod=""==rmethod?"simple":rmethod,""==rlabel)err_msgs=__("Label is required.","discount-and-dynamic-pricing");else if("simple"==rmethod){var ramount=thwdpf_base.get_property_field_value(form,"text","discount_amount");""==ramount?err_msgs=__("Discount Amount is required.","discount-and-dynamic-pricing"):$.isNumeric(ramount)?"percentage"!=rdisc_type||ramount>0&&ramount<=100?ramount<0&&(err_msgs=__("Please provide a positive numeric value for Discount Amount field","discount-and-dynamic-pricing")):err_msgs=__("Please provide a numeric value between 0 to 100 for Discount Amount field since it is a percentage discount","discount-and-dynamic-pricing"):err_msgs=__("Please provide a numeric value for Discount Amount field","discount-and-dynamic-pricing")}else"bulk"==rmethod&&(err_msgs=validate_bulk_pricing_values(form));return""==err_msgs&&(err_msgs=validate_date_time_values(form)),""==err_msgs||(form.find(".err_msgs").html(err_msgs),thwdpf_base.form_wizard_start(popup),!1)}function validate_date_time_values(form){var err_msgs="",start_date=thwdpf_base.get_property_field_value(form,"text","start_date"),start_time=thwdpf_base.get_property_field_value(form,"text","start_time"),end_date=thwdpf_base.get_property_field_value(form,"text","end_date"),end_time=thwdpf_base.get_property_field_value(form,"text","end_time");start_time=start_time||"00:00",end_time=end_time||"24:00";var start_datetime=thwdpf_base.prepare_datetime_obj(start_date,start_time),end_datetime=thwdpf_base.prepare_datetime_obj(end_date,end_time);return start_datetime&&end_datetime&&start_datetime>=end_datetime&&(err_msgs=__("The end date should be a date after the start date.","discount-and-dynamic-pricing")),err_msgs}function prepare_rule_form(form){var range_discounts_json=get_range_discounts(form),restrictions_json=thwdpf_conditions.get_conditional_rules(form);thwdpf_base.set_property_field_value(form,"hidden","range_discounts",range_discounts_json,0),thwdpf_base.set_property_field_value(form,"hidden","restrictions_other",restrictions_json,0)}function enable_disable_rule(elm,rname){var form=$(elm).closest("form");form.find("input[name=i_action]").val("enable_disable_rule"),form.find("input[name=i_enable_rname]").val(rname),form.submit()}function delete_rule(elm,rname){if(1==confirm(__("Are you sure you want to delete the selected discount rules?.","discount-and-dynamic-pricing"))){var form=$(elm).closest("form");$(elm).closest("tr").find('input:checkbox[name="select_rule[]"]').prop("checked",!0),form.find("input[name=i_action]").val("delete_rules"),form.submit()}}function delete_selected_rules(elm){var form=$(elm).closest("form");if(!(form.find('input:checkbox[name="select_rule[]"]:checked').length>0))return alert(__("No discount rules selected to delete. Please select atleast one.","discount-and-dynamic-pricing")),!1;1==confirm(__("Are you sure you want to delete the selected discount rule?.","discount-and-dynamic-pricing"))&&(form.find("input[name=i_action]").val("delete_rules"),form.submit())}function select_all_rules(elm){var checkAll=$(elm).prop("checked"),form=$(elm).closest("form");form.find('input:checkbox[name="select_rule[]"]').prop("checked",checkAll),form.find("input:checkbox[name=select_all]").prop("checked",checkAll)}function method_change_listener(elm){var form=$(elm).closest("form");"bulk"===$(elm).val()?(form.find(".form_field_discount_type").hide(),form.find(".form_field_discount_amount").hide(),form.find(".form_field_ranges").show()):(form.find(".form_field_ranges").hide(),form.find(".form_field_discount_type").show(),form.find(".form_field_discount_amount").show())}function need_login_change_listener(elm){var form=$(elm).closest("form"),need_login=$(elm).prop("checked"),allowed_roles_row=form.find(".form_field_allowed_roles"),allowed_roles_row_dummy=form.find(".form_field_allowed_roles_dummy");need_login?(allowed_roles_row.show(),allowed_roles_row_dummy.hide()):(allowed_roles_row.hide(),allowed_roles_row_dummy.show())}function get_range_discounts(form){for(var min_qty_arr=form.find("input[name='i_range_min_qty[]']").map(function(){return $(this).val()}).get(),max_qty_arr=form.find("input[name='i_range_max_qty[]']").map(function(){return $(this).val()}).get(),discount_arr=form.find("input[name='i_range_discount[]']").map(function(){return $(this).val()}).get(),discount_type_arr=form.find("select[name='i_range_discount_type[]']").map(function(){return $(this).val()}).get(),rangeSize=discount_arr.length,ranges=[],i=0;i<rangeSize;i++){var range={};range.min_qty=min_qty_arr[i],range.max_qty=max_qty_arr[i],range.discount=discount_arr[i],range.discount_type=discount_type_arr[i],ranges.push(range)}var range_json=ranges.length>0?JSON.stringify(ranges):"";return range_json=encodeURIComponent(range_json)}function populate_range_discounts(form,ranges){var rangesHtml="";ranges&&$.isArray(ranges)&&$.each(ranges,function(){rangesHtml+=prepare_discount_range_row_html(this)});var rangeTable=form.find(".thwdpf-discount-ranges tbody");rangesHtml?rangeTable.html(rangesHtml):rangeTable.html(prepare_discount_range_row_html(null))}function prepare_discount_range_row_html(range){var min_qty="",max_qty="",discount="",discount_type="";range&&(min_qty=$.isNumeric(range.min_qty)?range.min_qty:"",max_qty=$.isNumeric(range.max_qty)?range.max_qty:"",discount=$.isNumeric(range.discount)?range.discount:"",discount_type=range.discount_type?range.discount_type:"");var discount_types={fixed:__("Fixed","discount-and-dynamic-pricing"),percentage:__("Percentage","discount-and-dynamic-pricing")},html="<tr>"
;return html+='<td class="min-qty"><input type="text" name="i_range_min_qty[]" value="'+min_qty+'" placeholder="'+__("Min. Qty","discount-and-dynamic-pricing")+'"></td>',html+='<td class="max-qty"><input type="text" name="i_range_max_qty[]" value="'+max_qty+'" placeholder="'+__("Max. Qty","discount-and-dynamic-pricing")+'"></td>',html+='<td class="discount-type"><select name="i_range_discount_type[]" value="'+discount_type+'">',$.each(discount_types,function(value,text){html+='<option value="'+value+'" '+(discount_type===value?"selected":"")+">"+text+"</option>"}),html+="</select></td>",html+='<td class="discount"><input type="text" name="i_range_discount[]" value="'+discount+'" placeholder="'+__("Amount","discount-and-dynamic-pricing")+'"></td>',html+='<td class="action-cell">',html+='<a href="javascript:void(0)" onclick="thwdpfAddNewRangeRow(this)" class="btn btn-tiny btn-primary" title="'+__("Add new range","discount-and-dynamic-pricing")+'">+</a>',html+='<a href="javascript:void(0)" onclick="thwdpfRemoveRangeRow(this)" class="btn btn-tiny btn-danger" title="'+__("Remove range","discount-and-dynamic-pricing")+'">x</a>',html+="</tr>"}function add_new_range_row(elm){var ptable=$(elm).closest("table"),rowSize=ptable.find("tbody tr").size();if(rowSize>0){if(validate_pricing_range_row(elm)){var range=prepare_new_range_values(ptable,rowSize);ptable.find("tbody tr:last").after(prepare_discount_range_row_html(range))}}else ptable.find("tbody").append(prepare_discount_range_row_html(null))}function remove_range_row(elm){var ptable=$(elm).closest("table");$(elm).closest("tr").remove(),0==ptable.find("tbody tr").size()&&ptable.find("tbody").append(prepare_discount_range_row_html(null))}function prepare_new_range_values(ptable,size){if(size>0){var last_row=ptable.find("tbody tr:last");if(last_row){var new_min_qty=last_row.find(".max-qty input").val();return new_min_qty=$.isNumeric(new_min_qty)?parseInt(new_min_qty)+1:"",{min_qty:new_min_qty}}}return null}function validate_pricing_range_row(elm){var row=$(elm).closest("tr");if(row){var min_qty=row.find(".min-qty input").val(),max_qty=row.find(".max-qty input").val(),type=row.find(".discount-type select").val(),amount=row.find(".discount input").val(),err_msgs=validate_pricing_range(min_qty,max_qty,type,amount,!1);if(""!=err_msgs){return $(elm).closest("form").find(".err_msgs").html(err_msgs),!1}}return!0}function validate_pricing_range(min_qty,max_qty,type,amount,last_row){if(amount=$.isNumeric(amount)?parseInt(amount):"",min_qty=$.isNumeric(min_qty)?parseInt(min_qty):"",max_qty=last_row?$.isNumeric(max_qty)?parseInt(max_qty):max_qty:$.isNumeric(max_qty)?parseInt(max_qty):"",!$.isNumeric(min_qty))return __("Invalid pricing range. Please ensure that all the Min. Qty fields have valid values.","discount-and-dynamic-pricing");if(!(last_row||$.isNumeric(max_qty)&&max_qty>=min_qty))return __("Invalid pricing range. Please ensure that all the Max. Qty fields have valid values.","discount-and-dynamic-pricing");if(!type)return __("Invalid pricing range. Please ensure that all the Discount Type fields have valid values.","discount-and-dynamic-pricing");if(!$.isNumeric(amount))return __("Invalid pricing range. Please ensure that all the Amount fields have valid values.","discount-and-dynamic-pricing");if(amount<0)return __("Invalid pricing range. Please ensure that all the Amount fields have non-negative values.","discount-and-dynamic-pricing");if("percentage"==type&&!(amount>0&&amount<=100))return __("Invalid pricing range for percentage discount. Please ensure that all the Amount fields have values between 0 to 100.","discount-and-dynamic-pricing");if(last_row){if(!$.isNumeric(max_qty)&&""!=max_qty)return __("Invalid pricing range. Please ensure that the Max. Qty field on the last row have numeric value or blank.","discount-and-dynamic-pricing");if(min_qty>max_qty&&""!==max_qty)return __("Invalid pricing range. Please ensure that the Max. Qty field on the last row have valid value.","discount-and-dynamic-pricing")}return""}function validate_bulk_pricing_values(form){var err_msgs="",min_qty_arr=form.find("input[name='i_range_min_qty[]']").map(function(){return $(this).val()}).get(),max_qty_arr=form.find("input[name='i_range_max_qty[]']").map(function(){return $(this).val()}).get(),discount_arr=form.find("input[name='i_range_discount[]']").map(function(){return $(this).val()}).get(),discount_type_arr=form.find("select[name='i_range_discount_type[]']").map(function(){return $(this).val()}).get(),rangeSize=discount_arr.length;rangeSize<=0&&(err_msgs=__("Please add a valid pricing range.","discount-and-dynamic-pricing"));for(var last_max=-1,i=0;i<rangeSize;i++){var min_qty=min_qty_arr[i],max_qty=max_qty_arr[i];if(err_msgs=validate_pricing_range(min_qty,max_qty,discount_type_arr[i],discount_arr[i],!(i<rangeSize-1)))break;if(min_qty=$.isNumeric(min_qty)?parseInt(min_qty):"",last_max=$.isNumeric(last_max)?parseInt(last_max):"",min_qty<=last_max){err_msgs=__("Invalid pricing range. Please ensure that all the Min. Qty fields have valid values.","discount-and-dynamic-pricing");break}last_max=max_qty}return err_msgs}var _wp$i18n=wp.i18n,__=_wp$i18n.__;_wp$i18n._x,_wp$i18n._n,_wp$i18n._nx;return{open_new_rule_form:open_new_rule_form,open_edit_rule_form:open_edit_rule_form,open_copy_rule_form:open_copy_rule_form,enable_disable_rule:enable_disable_rule,delete_rule:delete_rule,delete_selected_rules:delete_selected_rules,select_all_rules:select_all_rules,save_rule:save_rule,add_new_range_row:add_new_range_row,remove_range_row:remove_range_row,method_change_listener:method_change_listener,need_login_change_listener:need_login_change_listener}}(window.jQuery,window,document),thwdpf_settings=function($,window,document){"use strict";function disable_settings_fields(){$("input[name=i_enable_bulk_pricing_table]").is(":checked")?$("input#a_fenable_caption_on_bulk_table").prop("disabled",!1):$("input#a_fenable_caption_on_bulk_table").prop("disabled",!0),$(document).on("click","input[name=i_enable_bulk_pricing_table]",function(){$(this).prop("checked")?($("input#a_fenable_caption_on_bulk_table").prop("disabled",!1),$("input#a_fenable_caption_on_bulk_table").prop("checked",!0)):$("input#a_fenable_caption_on_bulk_table").prop("disabled",!0)}),$("input[name=i_enable_strikeout]").is(":checked")?($("input#a_fon_product_page").prop("disabled",!1),$("input#a_fon_shop_page").prop("disabled",!1),$("input#a_fon_product_category").prop("disabled",!1)):($("input#a_fon_product_page").prop("disabled",!0),$("input#a_fon_shop_page").prop("disabled",!0),$("input#a_fon_product_category").prop("disabled",!0)),$(document).on("click","input[name=i_enable_strikeout]",function(){$(this).prop("checked")?($("input#a_fon_product_page").prop("disabled",!1),$("input#a_fon_shop_page").prop("disabled",!1),$("input#a_fon_product_category").prop("disabled",!1),$("input#a_fon_product_page").prop("checked",!0),$("input#a_fon_shop_page").prop("checked",!0),$("input#a_fon_product_category").prop("checked",!0)):($("input#a_fon_product_page").prop("disabled",!0),$("input#a_fon_shop_page").prop("disabled",!0),$("input#a_fon_product_category").prop("disabled",!0))})}function setup_review_request_notice(){setTimeout(function(){$("#thwdpf_review_request_notice").fadeIn(500)},2e3),$(document).on("click",".thpladmin-notice .notice-dismiss",function(){var wrapper=$(elm).closest("div.thpladmin-notice");trigger_review_request_notice_action(wrapper,wrapper.data("action"))})}function close_review_request_notice(elm){var wrapper=$(elm).closest("div.thpladmin-notice");trigger_review_request_notice_action(wrapper,"thwdpf_skip_review_request_notice"),$(wrapper).hide(50)}function trigger_review_request_notice_action(wrapper,action){var nonce=wrapper.data("nonce"),data={thwdpf_security:nonce,action:action};$.post(ajaxurl,data,function(){})}return $(function(){var settings_form=$("#thwdpf_discount_rules_form");thwdpf_base.setup_sortable_table(settings_form,"#thwdpf_discount_rules","0"),thwdpf_base.setup_tiptip_tooltips(),thwdpf_base.setup_form_wizard(),setup_review_request_notice(),disable_settings_fields()}),{close_review_request_notice:close_review_request_notice}}(window.jQuery,window,document);